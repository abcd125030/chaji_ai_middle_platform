# 火山引擎主体分割API文档

## 接口简介
运用先进的图像处理技术，对图片进行智能分割，可将图片中的主要实体均分割出来。

## 接口地址
- **URL**: `https://visual.volcengineapi.com`
- **请求方式**: POST
- **Content-Type**: application/json

## 公共参数
- **Region**: cn-north-1
- **Service**: cv

## Query参数
拼接到URL后的参数：`?Action=CVProcess&Version=2022-08-31`

| 参数 | 必选 | 类型 | 说明 |
|------|------|------|------|
| Action | 必选 | String | 接口名，取值：CVProcess |
| Version | 必选 | String | 版本号，取值：2022-08-31 |

## Body参数

### 必选参数

| 参数 | 类型 | 说明 |
|------|------|------|
| req_key | string | 取固定值: "saliency_seg" |
| binary_data_base64 | array of string | 输入图片base64数组，仅支持一张图（与image_urls二选一，优先生效） |
| image_urls | array of string | 图片文件URL数组，仅支持一张图（与binary_data_base64二选一） |

### 可选参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| return_url | bool | - | 输出是否返回图片链接，目前默认返回的jpeg格式，暂不支持透明度通道（Alpha通道） |
| only_mask | int | 0 | 返回格式控制：<br>0: 返回裁剪出主体区域的BGRA透明图片<br>1: 返回原图大小Mask分割图<br>2: 返回裁剪出主体区域的BGR前景图叠加方形纯色背景<br>3: 返回原图大小的BGRA透明前景图<br>4: 返回原图大小的BGRA透明前景图+原图大小mask两个产物<br>注：如使用0, 3, 4等需要返回透明底图的方式，需配合使用rgb=[-1, -1, -1] |
| rgb | array of int | [255, 255, 255] | 取值范围0～255，且仅当only_mask=2、3或4时才生效<br>当rgb为[-1,-1,-1]时，返回BGRA的透明图<br>注：业务使用请设置[-1,-1,-1]获得rgba透明底结果 |
| refine_mask | int | 0 | 边缘增强：<br>0：不对边缘增强<br>1：对边缘增强（matting lite 更快)<br>2：对边缘增强（matting large)（需精细化分割推荐开启该参数）<br>注：参数设为2时，且4通道返回结果时，将会对部分背景区域的rgb值设置为0，以减少产物体积 |
| logo_info | LogoInfo | - | 水印信息（详见下方LogoInfo结构） |

### LogoInfo结构

| 参数 | 类型 | 必选 | 默认值 | 说明 |
|------|------|------|--------|------|
| add_logo | Boolean | 否 | false | 是否添加水印。True为添加，False不添加 |
| position | Int | 否 | 0 | 水印的位置：<br>0-右下角<br>1-左下角<br>2-左上角<br>3-右上角 |
| language | Int | 否 | 0 | 水印的语言：<br>0-中文（AI生成）<br>1-英文（Generated by AI） |
| opacity | Float | 否 | 0.3 | 水印的不透明度，取值范围0-1，1表示完全不透明 |
| logo_text_content | String | 否 | - | 明水印自定义内容 |

## 图片要求
1. **图片格式**：JPG、JPEG、PNG、BMP等常见格式，建议使用JPG/PNG格式
2. **图片尺寸**：最小 128 x 128 像素，最大 4096 x 4096 像素
3. **文件大小**：base64格式下单张图片最大4.7MB

## 推荐配置

### 获取透明背景主体图（推荐）
```json
{
  "req_key": "saliency_seg",
  "image_urls": ["https://xxx"],
  "only_mask": 3,
  "rgb": [-1, -1, -1],
  "refine_mask": 0
}
```

### 获取精细分割结果
```json
{
  "req_key": "saliency_seg",
  "image_urls": ["https://xxx"],
  "only_mask": 3,
  "rgb": [-1, -1, -1],
  "refine_mask": 2
}
```

### 添加水印
```json
{
  "req_key": "saliency_seg",
  "image_urls": ["https://xxx"],
  "only_mask": 3,
  "rgb": [-1, -1, -1],
  "logo_info": {
    "add_logo": true,
    "position": 1,
    "language": 0,
    "opacity": 0.3,
    "logo_text_content": "自定义水印内容"
  }
}
```

## 响应参数

### 通用响应字段
| 字段 | 类型 | 说明 |
|------|------|------|
| code | int | 状态码，10000表示成功 |
| message | string | 状态信息 |
| request_id | string | 请求ID |
| status | int | 状态码 |
| time_elapsed | string | 处理耗时 |

### 业务数据字段（data）
| 字段 | 类型 | 说明 |
|------|------|------|
| binary_data_base64 | array of string | 返回主体分割图片的Base64编码 |
| image_urls | array of string | 图片url数组 |
| bbox | array | 主体边界框坐标 |
| contours_point | array | 轮廓点坐标 |
| ori_height | array of int | 原图高度 |
| ori_width | array of int | 原图宽度 |
| seg_score | array of float | 分割置信度分数 |

## 错误码

### 业务错误码
| HttpCode | 错误码 | 错误消息 | 描述 |
|----------|--------|----------|------|
| 200 | 10000 | 无 | 请求成功 |
| 400 | 61003 | Invalid Input Image: Image do not contain segment object | 图片中不包含可用于分割的物体 |

## 完整请求示例

```json
{
  "image_urls": ["https://xxx"],
  "only_mask": 3,
  "refine_mask": 0,
  "req_key": "saliency_seg",
  "logo_info": {
    "add_logo": true,
    "position": 1,
    "language": 0,
    "opacity": 0.3,
    "logo_text_content": "这里是明水印内容"
  },
  "rgb": [-1, -1, -1]
}
```

## 完整响应示例

```json
{
  "code": 10000,
  "data": {
    "algorithm_base_resp": {
      "status_code": 0,
      "status_message": "Success"
    },
    "bbox": [[1096, 438, 1857, 1766]],
    "binary_data_base64": ["base64_encoded_image_data"],
    "contours_point": [[[[2076, 440], [2058, 441]]]],
    "ori_height": [2204],
    "ori_width": [3306],
    "seg_score": [0.005572378635406494],
    "shadow": [null],
    "shadow_pos": [null]
  },
  "message": "Success",
  "request_id": "202408151152110AC5DB88EDFEDACF402A",
  "status": 10000,
  "time_elapsed": "1.440610819s"
}
```

## 注意事项

1. **透明背景**：如需获取透明背景的图片，必须设置 `rgb=[-1, -1, -1]`，并选择支持透明通道的 `only_mask` 值（0、3或4）

2. **性能优化**：
   - 如不需要精细分割，建议 `refine_mask` 设为0
   - 如需要精细分割，推荐 `refine_mask` 设为2

3. **返回格式选择**：
   - 仅需要主体图：使用 `only_mask=0`
   - 需要原图大小的透明图：使用 `only_mask=3`（推荐）
   - 需要mask和透明图两个结果：使用 `only_mask=4`

4. **水印设置**：
   - 水印默认不添加，需要明确设置 `add_logo=true`
   - 水印位置和透明度可根据需求调整

## SDK使用
详细SDK使用说明请参考：https://www.volcengine.com/docs/6444/1340578

## 原文档链接
https://www.volcengine.com/docs/6793/1330693