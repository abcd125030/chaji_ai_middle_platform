接口 1：获取 token
接口描述
此接口用于获取用户认证所需的 token。在使用需要身份验证的舆情分析系统接口（如舆情分析任务提交接口、舆情分析结果查询接口）前，用户需要先通过该接口获取有效的 token，以完成身份认证流程。
请求 URL
http://139.224.106.161:8015/api/service/auth/
请求方式
POST
请求示例
bash
curl --location 'http://139.224.106.161:8015/api/service/auth/' \
--header 'Content-Type: application/json' \
--data '{
  "appid": "feishu-lisongming_id",
  "secret": "***"
}'
返回示例
json
{
    "access_token":  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwianRpIjoiN2Q5MDYwM2U4YWNlNGVlYjlhYzFjMWRlZTdkM2RiZDUiLCJ1c2VyX2lkIjo1LCJhcHBpZCI6ImZlaXNodS1saXNvbmdtaW5nX2lkIiwiZXhwIjoxNzQyOTU4OTY1LCJpYXQiOjE3NDI5NTcxNjV9.hRLO9qHpGHM9EH_tcUOCys-BWYeT9F9ADPDmyu49mw4",
    "refresh_token": "***","expires_in": 1800
}
接口 2：舆情分析任务提交接口
接口描述
此接口用于提交舆情分析任务，支持提供文本内容以及相关图片，以供后台开展分析工作。通过该接口，用户能够将需要分析的舆情信息传递至系统，系统后续会依据既定的算法和模型对这些信息进行处理。
请求 URL
http://139.224.106.161:8015/api/customization/public_sentiment/handler/
请求方式
POST

bash
curl --location 'http://139.224.106.161:8015/api/customization/public_sentiment/handler/' \--header 'Content-Type: application/json' \--header 'Authorization: ••••••' \--data '{
    "task_id": "49af51a5-2341-4e78-b23d-68f842f7cc10",
    "content": "勇敢喵 发起投诉 2月16日晚上19：09在你们门店点了1杯奶茶...",
    "im_body": [
        "https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20241022/emyrja/dog_and_girl.jpeg",
        "https://help-static-aliyun-doc.aliyuncs.com/file-manage-files/zh-CN/20241022/emyrja/dog_and_girl.jpeg"
    ]
}'
返回示例
json
{
    "task_id": "49af51a5-2341-4e78-b23d-68f842f7cc10",
    "status": "处理中"
}
为了配合舆情分析业务后端，我这启动后台线程执行分析，请分析的结果以ORM的方式存到数据库中
def run_analysis():
    try:
        analysis(payload, input_model_dict, service_target, user_id)
    except Exception as e:
        logger.error(f"分析任务 {task_id} 失败: {str(e)}")

threading.Thread(target=run_analysis).start()


接口 3：舆情分析结果查询接口
接口描述
该接口主要用于查询指定任务 ID 的舆情分析结果。用户在提交舆情分析任务后，可通过此接口，依据任务 ID 获取系统对该任务的分析结果，以便了解舆情的性质、倾向以及相关分析依据。
请求 URL
http://139.224.106.161:8015/api/customization/public_sentiment/result/
请求方式
POST
请求示例
bash
curl --location 'http://139.224.106.161:8015/api/customization/public_sentiment/result/' \
--header 'Content-Type: application/json' \
--header 'Authorization: ••••••' \
--data '{
    "task_id": "49af51a5-2341-4e78-b23d-68f842f7cc10"
}'
返回示例
json
{
    "task_id": "49af51a5-2341-4e78-b23d-68f842f7cc10",
    "result": "负向",
    "score": "60",
    "reason": "用户对门店的奶茶产品提出了明确的不满，描述了饮用后出现身体不适的情况并发起投诉，符合负面的舆情客诉信息特征。"
}




参考文档: https://cx5n8kbm14.feishu.cn/wiki/V3fAwdiLAijl98kG5J0cb36wnfh