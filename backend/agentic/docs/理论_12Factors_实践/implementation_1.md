åŸºäºä»£ç åˆ†æï¼Œæˆ‘æ¥è¯¦ç»†è®¨è®ºå¯¹é“¾å¼ç»„ä»¶æ¶æ„çš„ç†è§£ï¼š

## ğŸ¯ ç»„ä»¶æ„æˆç†è§£

### 1. **é“¾å¼æ¶æ„çš„æ ¸å¿ƒç†å¿µ**

å½“å‰plannerå°±åƒä¸€ä¸ª"å…¨èƒ½å‹ç»ç†"ï¼Œæ—¢è¦åˆ†æé—®é¢˜ã€åˆ¶å®šç­–ç•¥ï¼Œåˆè¦åˆ†é…ä»»åŠ¡ã€æ£€æŸ¥è¿›åº¦ã€‚é“¾å¼æ¶æ„è¦æŠŠå®ƒæ‹†åˆ†æˆ"ä¸“ä¸šå›¢é˜Ÿ"ï¼š

```
å½“å‰æ¨¡å¼ï¼š
ç”¨æˆ·éœ€æ±‚ â†’ [å·¨å‹Planneråšæ‰€æœ‰å†³ç­–] â†’ å·¥å…·è°ƒç”¨

é“¾å¼æ¨¡å¼ï¼š
ç”¨æˆ·éœ€æ±‚ â†’ [åˆ†æå¸ˆ] â†’ [ç­–ç•¥å¸ˆ] â†’ [æ‰§è¡Œå®˜] â†’ å·¥å…·è°ƒç”¨
           æ¯ä¸ªäººåªåšè‡ªå·±æœ€æ“…é•¿çš„äº‹
```

### 2. **ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶çš„èŒèƒ½è®¾è®¡**

#### **Analyzerï¼ˆçŠ¶æ€åˆ†æå™¨ï¼‰- "ä¾¦å¯Ÿå…µ"**
```python
# æ ¸å¿ƒèŒè´£ï¼šç†è§£"æˆ‘ä»¬åœ¨å“ªé‡Œï¼Œè¦å»å“ªé‡Œ"
è¾“å…¥ï¼š
- åŸå§‹ä»»åŠ¡ç›®æ ‡
- å·²å®Œæˆçš„æ“ä½œæ‘˜è¦
- å½“å‰TODOçŠ¶æ€

å…³é”®åˆ¤æ–­ï¼š
- ä»»åŠ¡å®Œæˆåº¦å¦‚ä½•ï¼Ÿï¼ˆ0-100%ï¼‰
- è¿˜ç¼ºå°‘ä»€ä¹ˆå…³é”®ä¿¡æ¯ï¼Ÿ
- æ˜¯å¦å¯ä»¥ç»“æŸä»»åŠ¡ï¼Ÿ
- å½“å‰æ˜¯å¦é‡åˆ°é˜»å¡ï¼Ÿ

è¾“å‡ºç¤ºä¾‹ï¼š
{
    "completion_rate": 0.7,
    "needs_met": false,
    "missing_elements": ["ç”¨æˆ·è®¤è¯é€»è¾‘", "é”™è¯¯å¤„ç†"],
    "can_finish": false,
    "blocked_by": null
}
```

**ä¸ºä»€ä¹ˆç‹¬ç«‹å‡ºæ¥**ï¼šåˆ†æçŠ¶æ€ä¸éœ€è¦çŸ¥é“å·¥å…·ç»†èŠ‚ï¼Œåªéœ€è¦ç†è§£ä»»åŠ¡è¿›åº¦ã€‚è¿™æ ·å¯ä»¥ç”¨æ›´å°çš„æ¨¡å‹å¿«é€Ÿåˆ¤æ–­ã€‚

#### **Strategistï¼ˆç­–ç•¥åˆ¶å®šå™¨ï¼‰- "æŒ‡æŒ¥å®˜"**
```python
# æ ¸å¿ƒèŒè´£ï¼šå†³å®š"ä¸‹ä¸€æ­¥åšä»€ä¹ˆ"
è¾“å…¥ï¼š
- Analyzerçš„åˆ†æç»“æœ
- TODOä»»åŠ¡åˆ—è¡¨
- å¯ç”¨å·¥å…·ç±»åˆ«ï¼ˆä¸æ˜¯å…·ä½“å·¥å…·ï¼‰
- æœ€è¿‘3æ¬¡æ“ä½œçš„æ•ˆæœ

å…³é”®å†³ç­–ï¼š
- ä¼˜å…ˆå¤„ç†å“ªä¸ªTODOï¼Ÿ
- ä½¿ç”¨å“ªç±»å·¥å…·ï¼Ÿï¼ˆæœç´¢ç±»/åˆ†æç±»/ç”Ÿæˆç±»ï¼‰
- æ˜¯å¦éœ€è¦å¹¶è¡Œå¤„ç†ï¼Ÿ
- æ˜¯å¦éœ€è¦äººå·¥ä»‹å…¥ï¼Ÿ

è¾“å‡ºç¤ºä¾‹ï¼š
{
    "strategy": "implement_feature",  # æˆ– "gather_info", "fix_issue", "finalize"
    "priority_task_id": "todo_3",
    "tool_category": "code_generation",
    "parallel_allowed": false,
    "reasoning": "éœ€è¦å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½"
}
```

**ä¸ºä»€ä¹ˆç‹¬ç«‹å‡ºæ¥**ï¼šç­–ç•¥åˆ¶å®šæ˜¯é«˜å±‚å†³ç­–ï¼Œä¸éœ€è¦å…³å¿ƒå…·ä½“å‚æ•°ï¼Œè¿™æ ·å¯ä»¥è®©å®ƒä¸“æ³¨äº"æˆ˜ç•¥"è€Œé"æˆ˜æœ¯"ã€‚

#### **Executorï¼ˆæ‰§è¡Œå™¨ï¼‰- "å®æ–½è€…"**
```python
# æ ¸å¿ƒèŒè´£ï¼šæ„å»º"å…·ä½“æ€ä¹ˆåš"
è¾“å…¥ï¼š
- Strategistçš„ç­–ç•¥
- å…·ä½“å·¥å…·åˆ—è¡¨å’Œå‚æ•°è¦æ±‚
- æ•°æ®ç›®å½•ï¼ˆç”¨äºå‚æ•°å¡«å……ï¼‰
- ä¸Šä¸€æ¬¡ç›¸åŒå·¥å…·çš„æ‰§è¡Œå‚æ•°ï¼ˆç”¨äºå‚è€ƒï¼‰

å…³é”®ä»»åŠ¡ï¼š
- é€‰æ‹©å…·ä½“å·¥å…·
- æ„å»ºå®Œæ•´å‚æ•°
- å¤„ç†æ•°æ®å¼•ç”¨
- è®¾ç½®æœŸæœ›ç»“æœ

è¾“å‡ºç¤ºä¾‹ï¼ˆæ ‡å‡†PlannerOutputï¼‰ï¼š
{
    "thought": "ä½¿ç”¨ä»£ç åˆ†æå·¥å…·æŸ¥çœ‹è®¤è¯æ¨¡å—",
    "action": "CALL_TOOL",
    "tool_name": "FileAnalyzer",
    "tool_input": {
        "file_path": "auth/authentication.py",
        "analysis_type": "structure"
    },
    "expected_outcome": "è·å–è®¤è¯é€»è¾‘çš„å®Œæ•´ç»“æ„"
}
```

**ä¸ºä»€ä¹ˆç‹¬ç«‹å‡ºæ¥**ï¼šå‚æ•°æ„å»ºéœ€è¦è¯¦ç»†çš„å·¥å…·çŸ¥è¯†å’Œæ•°æ®å¼•ç”¨ï¼Œè¿™æ˜¯æœ€"æŠ€æœ¯æ€§"çš„éƒ¨åˆ†ã€‚

### 3. **ç»„ä»¶é—´çš„æ•°æ®æµè®¾è®¡**

```python
# ä¸æ˜¯ç®€å•çš„ä¸²è¡Œï¼Œè€Œæ˜¯æ™ºèƒ½çš„æ•°æ®ä¼ é€’
class ChainContext:
    """é“¾å¼è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œåœ¨ç»„ä»¶é—´ä¼ é€’"""
    
    # åŸå§‹è¾“å…¥ï¼ˆä¸å˜ï¼‰
    runtime_state: RuntimeState
    task_goal: str
    
    # é€æ­¥ç´¯ç§¯çš„åˆ†æç»“æœ
    analysis: Optional[AnalyzerOutput] = None
    strategy: Optional[StrategistOutput] = None
    
    # å…±äº«çš„å·¥å…·ä¿¡æ¯ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰
    available_tools: List[Tool] = []
    data_catalog: Dict = {}
    
    # æ€§èƒ½ç›‘æ§
    token_usage: Dict[str, int] = {}
    time_spent: Dict[str, float] = {}
```

### 4. **ä¸ºä»€ä¹ˆè¿™æ ·æ‹†åˆ†æ›´åˆç†**

#### **è§£å†³ç®€å•é—®é¢˜çš„ä¼˜åŒ–è·¯å¾„**ï¼š
```python
# ç®€å•æŸ¥è¯¢åœºæ™¯
if analyzer.completion_rate > 0.8 and len(analyzer.missing_elements) == 1:
    # å¯ä»¥è·³è¿‡Strategistï¼Œç›´æ¥è®©Executorå¤„ç†
    return executor.quick_finish(analyzer.missing_elements[0])

# å¤æ‚åœºæ™¯æ‰èµ°å®Œæ•´é“¾è·¯
```

#### **TokenèŠ‚çœçš„æ¥æº**ï¼š
- **Analyzer**: ä¸éœ€è¦å·¥å…·æè¿°ã€æ•°æ®ç›®å½• â†’ èŠ‚çœ60% tokens
- **Strategist**: ä¸éœ€è¦è¯¦ç»†å†å²ã€å…·ä½“å‚æ•° â†’ èŠ‚çœ50% tokens  
- **Executor**: ä¸éœ€è¦æ€è€ƒæ¡†æ¶ã€å†³ç­–æŒ‡å— â†’ èŠ‚çœ40% tokens

#### **çµæ´»æ€§æå‡**ï¼š
```python
# å¯ä»¥æ ¹æ®åœºæ™¯é€‰æ‹©ä¸åŒçš„é“¾è·¯
class PlannerChainFactory:
    @staticmethod
    def create_chain(task_type: str):
        if task_type == "simple_query":
            return Analyzer() | QuickExecutor()
        elif task_type == "complex_planning":
            return Analyzer() | Strategist() | Executor() | Validator()
        else:
            return Analyzer() | Strategist() | Executor()
```

### 5. **å®æ–½çš„å…³é”®æŒ‘æˆ˜**

1. **ç»„ä»¶è¾¹ç•Œçš„ç¡®å®š**ï¼š
   - å“ªäº›ä¿¡æ¯æ¯ä¸ªç»„ä»¶çœŸæ­£éœ€è¦ï¼Ÿ
   - å¦‚ä½•é¿å…é‡å¤è®¡ç®—ï¼Ÿ

2. **é”™è¯¯å¤„ç†**ï¼š
   - å¦‚æœAnalyzeråˆ¤æ–­é”™è¯¯æ€ä¹ˆåŠï¼Ÿ
   - é“¾è·¯ä¸­æ–­å¦‚ä½•æ¢å¤ï¼Ÿ

3. **æ€§èƒ½å¹³è¡¡**ï¼š
   - ä¸‰æ¬¡LLMè°ƒç”¨ vs ä¸€æ¬¡å¤§è°ƒç”¨
   - éœ€è¦å®æµ‹æ¥éªŒè¯

4. **promptå·¥ç¨‹**ï¼š
   - æ¯ä¸ªç»„ä»¶çš„promptè¦æåº¦ç²¾ç®€
   - ä½†åˆä¸èƒ½ä¸¢å¤±å…³é”®ä¿¡æ¯

### 6. **ç¬¬ä¸€é˜¶æ®µå®æ–½é‡ç‚¹**

å»ºè®®å…ˆå®ç°ï¼š
1. **åŸºç¡€æ¡†æ¶**ï¼šChainContext + åŸºç±»BaseChainComponent
2. **Analyzerç»„ä»¶**ï¼šæœ€ç‹¬ç«‹ï¼Œæœ€å®¹æ˜“éªŒè¯
3. **ç®€å•é“¾è·¯**ï¼šAnalyzer â†’ QuickFinishï¼ˆç”¨äºç®€å•åœºæ™¯ï¼‰
4. **æ€§èƒ½å¯¹æ¯”**ï¼šæ–°æ—§æ–¹æ¡ˆçš„A/Bæµ‹è¯•æ¡†æ¶

è¿™æ ·å¯ä»¥å¿«é€ŸéªŒè¯æ¶æ„çš„å¯è¡Œæ€§ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§æ”¹é€ æ‰€æœ‰é€»è¾‘ã€‚

æ‚¨è§‰å¾—è¿™ä¸ªç†è§£æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿç‰¹åˆ«æ˜¯ç»„ä»¶èŒè´£çš„åˆ’åˆ†ï¼Œæ˜¯å¦éœ€è¦è°ƒæ•´ï¼Ÿ