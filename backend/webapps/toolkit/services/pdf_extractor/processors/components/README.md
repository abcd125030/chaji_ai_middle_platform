# Step1 æ ¸å¿ƒç»„ä»¶ (Components)

æœ¬ç›®å½•åŒ…å« Step1 PDFæ–‡æœ¬æå–å™¨çš„æ ¸å¿ƒä¸šåŠ¡ç»„ä»¶ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
components/
â”œâ”€â”€ __init__.py                      # ç»„ä»¶å¯¼å‡º
â”œâ”€â”€ README.md                        # æœ¬æ–‡æ¡£
â”œâ”€â”€ step1_page_analyzer.py           # é¡µé¢å…ƒç´ åˆ†æå™¨
â”œâ”€â”€ step1_extraction_strategy.py     # æå–ç­–ç•¥å†³ç­–å™¨
â””â”€â”€ step1_ocr_handler.py             # OCRå¤„ç†å™¨
```

## ğŸ§© ç»„ä»¶è¯´æ˜

### 1. PageAnalyzer (é¡µé¢å…ƒç´ åˆ†æå™¨)

**åŠŸèƒ½**ï¼šåˆ†æPDFé¡µé¢çš„å…ƒç´ æ„æˆï¼Œç”Ÿæˆè§£ææŒ‡æ ‡

**æ ¸å¿ƒç±»**ï¼š
- `PageAnalyzer`: åˆ†æå™¨ä¸»ç±»
- `PageAnalysisResult`: åˆ†æç»“æœæ•°æ®ç±»

**åˆ†ææŒ‡æ ‡**ï¼š
- æ–‡æœ¬ï¼šé•¿åº¦ã€å•è¯æ•°ã€æ–‡æœ¬å—æ•°
- å›¾ç‰‡ï¼šæ•°é‡ã€å°ºå¯¸ã€ä½ç½®
- è¡¨æ ¼ï¼šæ•°é‡ã€è¡Œåˆ—æ•°
- ç»˜å›¾ï¼šçº¿æ¡ã€çŸ©å½¢ã€æ›²çº¿ã€ç»˜å›¾å…ƒç´ 
- å¤æ‚åº¦ï¼šç»¼åˆè¯„åˆ† (0-1)

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from .components import PageAnalyzer

analyzer = PageAnalyzer()
result = analyzer.analyze_page('document.pdf', page_number=1)

print(f"æ–‡æœ¬é•¿åº¦: {result.text_length}")
print(f"å›¾ç‰‡æ•°é‡: {result.image_count}")
print(f"å¤æ‚åº¦: {result.get_complexity_score():.2f}")
```

### 2. ExtractionStrategyDecider (æå–ç­–ç•¥å†³ç­–å™¨)

**åŠŸèƒ½**ï¼šæ ¹æ®é¡µé¢åˆ†æç»“æœï¼Œæ™ºèƒ½å†³ç­–æœ€ä½³æå–ç­–ç•¥

**æ ¸å¿ƒç±»**ï¼š
- `ExtractionStrategy`: ç­–ç•¥æšä¸¾ï¼ˆDIRECT_TEXT, OCR, HYBRID, TABLE_ONLYï¼‰
- `ExtractionStrategyDecider`: å†³ç­–å™¨ä¸»ç±»

**å†³ç­–é€»è¾‘**ï¼š
- æ–‡æœ¬ä¸°å¯Œ â†’ ç›´æ¥æå–
- å›¾ç‰‡å ä¸»å¯¼ â†’ OCR
- å¤æ‚ç»˜å›¾ â†’ OCR
- æ··åˆåœºæ™¯ â†’ æ··åˆç­–ç•¥

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from .components import ExtractionStrategyDecider

decider = ExtractionStrategyDecider()
decision = decider.decide_strategy(analysis_result)

print(f"ç­–ç•¥: {decision['strategy'].value}")
print(f"ç½®ä¿¡åº¦: {decision['confidence']:.2f}")
print(f"ç†ç”±: {decision['reason']}")
```

### 3. OCRHandler (OCRå¤„ç†å™¨)

**åŠŸèƒ½**ï¼šä½¿ç”¨ qwen3-vl-plus å¤šæ¨¡æ€æ¨¡å‹è¿›è¡ŒPDFé¡µé¢OCRè¯†åˆ«

**æ ¸å¿ƒç±»**ï¼š
- `OCRHandler`: OCRå¤„ç†å™¨ä¸»ç±»

**ç‰¹ç‚¹**ï¼š
- è‡ªåŠ¨æ¸²æŸ“PDFé¡µé¢ä¸ºé«˜åˆ†è¾¨ç‡å›¾ç‰‡
- è°ƒç”¨å¤šæ¨¡æ€æ¨¡å‹è¿›è¡Œè§†è§‰ç†è§£
- ä¸“ä¸šçš„OCRæç¤ºè¯ï¼ˆè¯†åˆ«å…¬å¼ã€è¡¨æ ¼ã€å›¾è¡¨ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from .components import OCRHandler

ocr = OCRHandler(api_key='...', base_url='...', model='qwen3-vl-plus')
text, debug_info = ocr.ocr_pdf_page('document.pdf', page_number=3, dpi=300)

print(f"è¯†åˆ«æ–‡æœ¬: {text}")
print(f"Tokenä½¿ç”¨: {debug_info['total_tokens']}")
```

## ğŸ”„ ç»„ä»¶åä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    smart_extract_page()                     â”‚
â”‚                  (step1_text_extractor.py)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PageAnalyzer    â”‚ â”‚ StrategyDecider  â”‚ â”‚   OCRHandler     â”‚
â”‚  åˆ†æé¡µé¢å…ƒç´      â”‚â†’â”‚  å†³ç­–æå–ç­–ç•¥     â”‚â†’â”‚   æ‰§è¡ŒOCRè¯†åˆ«     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     åˆ†ææŒ‡æ ‡              ç­–ç•¥+ç½®ä¿¡åº¦            è¯†åˆ«æ–‡æœ¬
```

## ğŸ“‹ è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶ä¸“æ³¨äºä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½
2. **æ¾è€¦åˆ**ï¼šç»„ä»¶ä¹‹é—´é€šè¿‡æ¸…æ™°çš„æ¥å£äº¤äº’
3. **å¯æµ‹è¯•**ï¼šæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
4. **å¯é…ç½®**ï¼šå…³é”®å‚æ•°æ”¯æŒè‡ªå®šä¹‰é…ç½®
5. **æ—¥å¿—å®Œå–„**ï¼šè¯¦ç»†çš„æ­¥éª¤æ—¥å¿—ä¾¿äºè°ƒè¯•

## ğŸš€ æœªæ¥æ‰©å±•

- [ ] æ”¯æŒæ›´å¤šOCRæ¨¡å‹ï¼ˆå¦‚ GPT-4o-miniï¼‰
- [ ] å¢åŠ è¡¨æ ¼ä¸“é—¨è¯†åˆ«ç»„ä»¶
- [ ] æ”¯æŒå›¾è¡¨è¯­ä¹‰ç†è§£
- [ ] æ·»åŠ é¡µé¢åˆ†ç±»ç»„ä»¶ï¼ˆè®ºæ–‡/æ‚å¿—/æŠ¥å‘Šç­‰ï¼‰
- [ ] æ”¯æŒè‡ªå®šä¹‰ç­–ç•¥è§„åˆ™
