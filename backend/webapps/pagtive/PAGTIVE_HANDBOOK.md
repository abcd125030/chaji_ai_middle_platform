# Pagtive æ¨¡å—æŠ€æœ¯æ‰‹å†Œ

**æœ€åæ›´æ–°**: 2025-09-02  
**é¡¹ç›®çŠ¶æ€**: ç”Ÿäº§å¯ç”¨ï¼ŒæŒç»­ä¼˜åŒ–ä¸­

## æ¨¡å—æ¦‚è¿°

Pagtive æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„é¡µé¢ç”Ÿæˆå’Œé¡¹ç›®ç®¡ç†åº”ç”¨ï¼Œä»åŸ Next.js é¡¹ç›®è¿ç§»åˆ° Django åç«¯çš„ç»Ÿä¸€æ¶æ„ä¸­ã€‚è¯¥æ¨¡å—æ”¯æŒé€šè¿‡è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆå®Œæ•´çš„ç½‘é¡µé¡¹ç›®ï¼ŒåŒ…æ‹¬å¤šä¸ªé¡µé¢çš„ HTMLã€CSS å’Œ JavaScript ä»£ç ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **é¡¹ç›®ç®¡ç†**ï¼šåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤å’Œåˆ†äº«é¡¹ç›®
- **AI é¡µé¢ç”Ÿæˆ**ï¼šé€šè¿‡è‡ªç„¶è¯­è¨€ç”Ÿæˆé¡µé¢ä»£ç 
- **é¡µé¢ç¼–è¾‘**ï¼šAI è¾…åŠ©ç¼–è¾‘ç°æœ‰é¡µé¢
- **é¡¹ç›®å¤§çº²ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆé¡¹ç›®é¡µé¢ç»“æ„
- **å…¬å¼€åˆ†äº«**ï¼šæ”¯æŒé¡¹ç›®å…¬å¼€å’Œåˆ†äº«åŠŸèƒ½

### æ ¸å¿ƒä»·å€¼
- **æ•ˆç‡æå‡**: ä¼ ç»Ÿæ¼”ç¤ºæ–‡ç¨¿åˆ¶ä½œä»å°æ—¶çº§åˆ«ç¼©çŸ­åˆ°åˆ†é’Ÿçº§åˆ«
- **ä¸“ä¸šå“è´¨**: AI ç”Ÿæˆçš„å†…å®¹å…·å¤‡ä¸“ä¸šè®¾è®¡æ°´å‡†
- **æ˜“ç”¨æ€§**: æ— éœ€è®¾è®¡æŠ€èƒ½ï¼Œç®€å•æè¿°å³å¯ç”Ÿæˆå†…å®¹
- **åä½œåˆ†äº«**: ä¾¿æ·çš„åˆ†äº«æœºåˆ¶å’Œå…¬å¼€å±•ç¤º

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Next.js)                       â”‚
â”‚  /web/src/app/pagtive/*                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP API
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API ä»£ç†å±‚ (Next.js)                    â”‚
â”‚  /web/src/app/api/pagtive/*                             â”‚
â”‚  ä½¿ç”¨ proxyToBackend è½¬å‘è¯·æ±‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ 
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Django åç«¯                            â”‚
â”‚  /backend/webapps/pagtive/                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Views (è§†å›¾å±‚)                                          â”‚
â”‚  â”œâ”€â”€ ProjectViewSet     - é¡¹ç›® CRUD                     â”‚
â”‚  â”œâ”€â”€ GenerateViewSet    - AI ç”ŸæˆåŠŸèƒ½                   â”‚
â”‚  â””â”€â”€ ShareViewSet       - åˆ†äº«åŠŸèƒ½                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Services (æœåŠ¡å±‚)                                       â”‚
â”‚  â”œâ”€â”€ ProjectService         - é¡¹ç›®ä¸šåŠ¡é€»è¾‘              â”‚
â”‚  â”œâ”€â”€ PageGenerationService  - AI é¡µé¢ç”Ÿæˆ               â”‚
â”‚  â”œâ”€â”€ ConfigurationService   - é…ç½®ç®¡ç†                  â”‚
â”‚  â””â”€â”€ StorageService         - æ–‡ä»¶å­˜å‚¨                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Models (æ•°æ®å±‚)                                         â”‚
â”‚  â”œâ”€â”€ Project        - é¡¹ç›®ä¸»è¡¨                          â”‚
â”‚  â”œâ”€â”€ ProjectDetail  - é¡µé¢è¯¦æƒ…                          â”‚
â”‚  â”œâ”€â”€ ProjectLLMLog  - LLM è°ƒç”¨æ—¥å¿—                      â”‚
â”‚  â””â”€â”€ PagtiveConfig  - é…ç½®è¡¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å¤–éƒ¨æœåŠ¡å’Œå­˜å‚¨                              â”‚
â”‚  â”œâ”€â”€ PostgreSQL    - ä¸»æ•°æ®åº“                           â”‚
â”‚  â”œâ”€â”€ LLM Service   - AI æ¨¡å‹æœåŠ¡                        â”‚
â”‚  â””â”€â”€ OSS           - å¯¹è±¡å­˜å‚¨æœåŠ¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡å±‚æ¶æ„

é¡¹ç›®é‡‡ç”¨æœåŠ¡å±‚æ¶æ„æ¨¡å¼ï¼Œå°†ä¸šåŠ¡é€»è¾‘ä»è§†å›¾å±‚åˆ†ç¦»ï¼š

#### 1. ProjectService - é¡¹ç›®ç®¡ç†æœåŠ¡
```python
from webapps.pagtive.services import ProjectService
service = ProjectService()

# åˆ›å»ºé¡¹ç›®ï¼ˆæ”¯æŒè‡ªåŠ¨ç”Ÿæˆå¤§çº²ï¼‰
project = service.create_project(
    user=user,
    project_name="æˆ‘çš„ç½‘ç«™",
    generate_outline=True
)
# ç®¡ç†é¡µé¢åˆ—è¡¨
page = service.add_page_to_project(project, "é¡µé¢æ ‡é¢˜")
```

#### 2. PageGenerationService - AI é¡µé¢ç”ŸæˆæœåŠ¡
```python
from webapps.pagtive.services import PageGenerationService
service = PageGenerationService()

# ç”Ÿæˆé¡µé¢å†…å®¹
result = service.generate_page_content(
    project=project,
    user=user,
    prompt="åˆ›å»ºäº§å“å±•ç¤ºé¡µé¢"
)
# ç¼–è¾‘ç°æœ‰é¡µé¢
result = service.edit_page_content(
    project=project,
    page_id=1,
    edit_prompt="ä¿®æ”¹èƒŒæ™¯è‰²"
)
```

#### 3. ConfigurationService - é…ç½®ç®¡ç†æœåŠ¡
- ç®¡ç† LLM é…ç½®ï¼ˆæ¨¡å‹é€‰æ‹©ã€å‚æ•°è®¾ç½®ï¼‰
- ç¼“å­˜é…ç½®ï¼ˆ5åˆ†é’ŸTTLï¼‰
- æä¾›é»˜è®¤é…ç½®å’Œæç¤ºè¯æ¨¡æ¿

#### 4. StorageService - å­˜å‚¨æœåŠ¡
- æ–‡ä»¶ä¸Šä¼ åˆ° OSS
- ç®¡ç†æ–‡ä»¶è·¯å¾„å’Œè®¿é—®URL
- æ”¯æŒæ‰¹é‡æ“ä½œ

### LLM è°ƒç”¨é“¾æ¶æ„

```mermaid
graph TD
    A[ç”¨æˆ·è¯·æ±‚] --> B[PageGenerationService]
    B --> C[ConfigurationService]
    C --> D[PagtiveConfig DB]
    D --> E[è·å–æ¿€æ´»é…ç½®]
    E --> F[è·å–LLMæ¨¡å‹é…ç½®]
    F --> G[è·å–æç¤ºè¯æ¨¡æ¿]
    G --> H[æ„å»ºå®Œæ•´æç¤ºè¯]
    H --> I[LLMService.internal]
    I --> J[CoreLLMService]
    J --> K[LLM APIè°ƒç”¨]
    K --> L[å“åº”å¤„ç†]
    L --> M[ä¿å­˜åˆ°ProjectDetail]
```

### é¡µé¢æ•°æ®å…³è”æœºåˆ¶

`Project.pages`ï¼ˆJSONå­—æ®µï¼‰ä¸ `ProjectDetail`ï¼ˆè¡¨è®°å½•ï¼‰çš„åŒå‘å…³è”ï¼š
- **pageså­—æ®µ**: å­˜å‚¨é¡µé¢å…ƒä¿¡æ¯ `[{"id": "1", "title": "é¦–é¡µ", "order": 100}]`
- **ProjectDetail**: å­˜å‚¨é¡µé¢å®é™…å†…å®¹ï¼ˆHTML/CSS/JSï¼‰
- **å…³è”é”®**: `page_id` è¿æ¥ä¸¤è€…
- **è‡ªåŠ¨åŒæ­¥**: ç”Ÿæˆæ–°é¡µé¢æ—¶è‡ªåŠ¨æ›´æ–° `project.pages`

## æ•°æ®æ¨¡å‹

### Projectï¼ˆé¡¹ç›®è¡¨ï¼‰
```python
- id: UUID ä¸»é”®
- user: ç”¨æˆ·å…³è”
- project_name: é¡¹ç›®åç§°
- project_description: é¡¹ç›®æè¿°
- project_style: é¡¹ç›®é£æ ¼
- global_style_code: å…¨å±€æ ·å¼
- pages: JSONField é¡µé¢åˆ—è¡¨
- is_public: æ˜¯å¦å…¬å¼€
- is_published: æ˜¯å¦å‘å¸ƒ
- created_at: åˆ›å»ºæ—¶é—´
- updated_at: æ›´æ–°æ—¶é—´
```

### ProjectDetailï¼ˆé¡µé¢è¯¦æƒ…è¡¨ï¼‰
```python
- project: é¡¹ç›®å…³è”
- page_id: é¡µé¢ID
- html: HTMLå†…å®¹
- styles: CSSæ ·å¼
- script: JavaScriptè„šæœ¬
- mermaid_content: Mermaidå›¾è¡¨
- images: å›¾ç‰‡åˆ—è¡¨
- version_id: ç‰ˆæœ¬å·
```

### ProjectLLMLogï¼ˆLLMè°ƒç”¨æ—¥å¿—è¡¨ï¼‰
```python
- project: é¡¹ç›®å…³è”
- page_id: é¡µé¢ID
- scenario: åœºæ™¯ç±»å‹
- prompt: ç”¨æˆ·æç¤º
- llm_request: è¯·æ±‚å†…å®¹
- llm_response: å“åº”å†…å®¹
- status: å¤„ç†çŠ¶æ€
- request_timestamp: è¯·æ±‚æ—¶é—´
- response_timestamp: å“åº”æ—¶é—´
```

### PagtiveConfigï¼ˆé…ç½®è¡¨ï¼‰
```python
- name: é…ç½®åç§°
- llm_config: LLMé…ç½®
- prompt_templates: æç¤ºè¯æ¨¡æ¿
- is_active: æ˜¯å¦æ¿€æ´»
```

## API æ¥å£è§„èŒƒ

### é¡¹ç›®ç®¡ç†æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| é¡¹ç›®åˆ—è¡¨ | GET | `/api/pagtive/projects` | è·å–ç”¨æˆ·çš„æ‰€æœ‰é¡¹ç›® |
| åˆ›å»ºé¡¹ç›® | POST | `/api/pagtive/projects` | åˆ›å»ºæ–°é¡¹ç›® |
| é¡¹ç›®è¯¦æƒ… | GET | `/api/pagtive/projects/{id}` | è·å–é¡¹ç›®è¯¦ç»†ä¿¡æ¯ |
| æ›´æ–°é¡¹ç›® | PUT/PATCH | `/api/pagtive/projects/{id}` | æ›´æ–°é¡¹ç›®ä¿¡æ¯ |
| åˆ é™¤é¡¹ç›® | DELETE | `/api/pagtive/projects/{id}` | åˆ é™¤é¡¹ç›® |

### é¡µé¢ç®¡ç†æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| é¡µé¢åˆ—è¡¨ | GET | `/api/pagtive/projects/{id}/pages` | è·å–é¡¹ç›®çš„æ‰€æœ‰é¡µé¢ |
| åˆ›å»ºé¡µé¢ | POST | `/api/pagtive/projects/{id}/pages` | åˆ›å»ºæ–°é¡µé¢ |
| é¡µé¢è¯¦æƒ… | GET | `/api/pagtive/projects/{id}/pages/{pageId}` | è·å–é¡µé¢è¯¦æƒ… |
| æ›´æ–°é¡µé¢ | PUT | `/api/pagtive/projects/{id}/pages/{pageId}` | æ›´æ–°é¡µé¢å†…å®¹ |
| åˆ é™¤é¡µé¢ | DELETE | `/api/pagtive/projects/{id}/pages/{pageId}` | åˆ é™¤é¡µé¢ |

### AI ç”Ÿæˆæ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”Ÿæˆå†…å®¹ | POST | `/api/pagtive/generate` | ç”Ÿæˆæˆ–ç¼–è¾‘é¡µé¢å†…å®¹ |
| ç”Ÿæˆå¤§çº² | POST | `/api/pagtive/projects/{id}/generate-outline` | ç”Ÿæˆé¡¹ç›®å¤§çº² |

### åˆ†äº«æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–åˆ†äº« | GET | `/api/pagtive/share/{id}` | è·å–å…¬å¼€é¡¹ç›®ï¼ˆæ— éœ€è®¤è¯ï¼‰ |

## æ ¸å¿ƒæµç¨‹

### é¡¹ç›®åˆ›å»ºæµç¨‹

1. **ç”¨æˆ·æäº¤é¡¹ç›®ä¿¡æ¯**
   ```json
   {
     "project_name": "ä¼ä¸šå®˜ç½‘",
     "project_description": "å…¬å¸ä»‹ç»ç½‘ç«™",
     "project_style": "ç°ä»£ç®€çº¦",
     "generate_outline": true
   }
   ```

2. **åç«¯å¤„ç†æµç¨‹**
   - ProjectService.create_project() åˆ›å»ºé¡¹ç›®å®ä¾‹
   - å¦‚æœ generate_outline=trueï¼Œè°ƒç”¨ PageGenerationService.generate_project_outline()
   - LLM ç”Ÿæˆé¡µé¢åˆ—è¡¨ç»“æ„
   - ä¸ºæ¯ä¸ªé¡µé¢åˆ›å»º ProjectDetail è®°å½•
   - è¿”å›å®Œæ•´çš„é¡¹ç›®ä¿¡æ¯

3. **æ•°æ®å­˜å‚¨**
   - Project è¡¨å­˜å‚¨é¡¹ç›®å…ƒæ•°æ®
   - pages å­—æ®µå­˜å‚¨é¡µé¢åˆ—è¡¨ç»“æ„
   - ProjectDetail è¡¨å­˜å‚¨æ¯ä¸ªé¡µé¢çš„å…·ä½“å†…å®¹

### AI é¡µé¢ç”Ÿæˆ/ç¼–è¾‘æµç¨‹

1. **ç”Ÿæˆæ–°é¡µé¢**
   ```json
   {
     "projectId": "xxx",
     "prompt": "åˆ›å»ºä¸€ä¸ªäº§å“å±•ç¤ºé¡µé¢",
     "scenario": "generatePageCode"
   }
   ```

2. **ç¼–è¾‘ç°æœ‰é¡µé¢**
   ```json
   {
     "projectId": "xxx",
     "pageId": "1",
     "prompt": "æ·»åŠ ä¸€ä¸ªè”ç³»è¡¨å•",
     "scenario": "editPageCode",
     "current": {
       "html": "ç°æœ‰HTML",
       "styles": "ç°æœ‰CSS",
       "script": "ç°æœ‰JS"
     }
   }
   ```

3. **å¤„ç†æµç¨‹**
   - PageGenerationService æ ¹æ® scenario é€‰æ‹©æç¤ºè¯æ¨¡æ¿
   - è°ƒç”¨ LLM æœåŠ¡ç”Ÿæˆ/ä¿®æ”¹å†…å®¹
   - ä¿å­˜åˆ° ProjectDetail
   - æ›´æ–° project.pages
   - è®°å½• LLM è°ƒç”¨æ—¥å¿—

## å¼€å‘å’Œæµ‹è¯•

### å¯åŠ¨æœåŠ¡

```bash
# åç«¯æœåŠ¡
cd /Users/chagee/Repos/X/backend
source .venv/bin/activate
python manage.py runserver

# å‰ç«¯æœåŠ¡
cd /Users/chagee/Repos/X/web
pnpm dev
```

### API æµ‹è¯•ç¤ºä¾‹

```bash
# è·å–é¡¹ç›®åˆ—è¡¨
curl -X GET http://localhost:3000/api/pagtive/projects \
  -H "Authorization: Bearer YOUR_TOKEN"

# åˆ›å»ºé¡¹ç›®
curl -X POST http://localhost:3000/api/pagtive/projects \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "project_name": "æµ‹è¯•é¡¹ç›®",
    "project_description": "æµ‹è¯•æè¿°",
    "generate_outline": true
  }'

# ç”Ÿæˆé¡µé¢å†…å®¹
curl -X POST http://localhost:3000/api/pagtive/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "projectId": "xxx",
    "prompt": "åˆ›å»ºä¸€ä¸ªç™»å½•é¡µé¢",
    "scenario": "generatePageCode"
  }'
```

### å‰ç«¯é›†æˆ

```typescript
import { authFetch } from '@/lib/auth-fetch';

// è·å–é¡¹ç›®åˆ—è¡¨
const response = await authFetch('/api/pagtive/projects');
const projects = await response.json();

// åˆ›å»ºé¡¹ç›®
const response = await authFetch('/api/pagtive/projects', {
  method: 'POST',
  body: JSON.stringify({
    project_name: 'æ–°é¡¹ç›®',
    project_description: 'é¡¹ç›®æè¿°'
  })
});

// ç”Ÿæˆé¡µé¢
const response = await authFetch('/api/pagtive/generate', {
  method: 'POST',
  body: JSON.stringify({
    projectId: 'xxx',
    prompt: 'åˆ›å»ºäº§å“é¡µé¢',
    scenario: 'generatePageCode'
  })
});
```

### å…³é”®å‰ç«¯ç»„ä»¶

#### è®¤è¯ç³»ç»Ÿ (authFetch)
- è‡ªåŠ¨å¤„ç†JWTè®¤è¯å¤´
- 401é”™è¯¯è‡ªåŠ¨è·³è½¬ç™»å½•
- æ”¯æŒç›¸å¯¹å’Œç»å¯¹URL

#### ç¼“å­˜ç®¡ç† (pagtiveCache)
- é¡¹ç›®çº§å†…å­˜ç¼“å­˜
- æ•°æ®å˜æ›´æ—¶ä¸»åŠ¨æ¸…é™¤
- å‡å°‘é‡å¤APIè°ƒç”¨

#### æ²™ç›’é¢„è§ˆ (CodePreviewSandbox)
```typescript
<CodePreviewSandbox
  htmlContent={html}
  cssContent={css} 
  jsContent={js}
  globalStyleCode={globalCss}
  mermaidContent={mermaid}
/>
```
- iframeéš”ç¦»æ‰§è¡Œç¯å¢ƒ
- æ”¯æŒå¤–éƒ¨åº“åŠ è½½
- é˜²æ­¢XSSæ”»å‡»

## é…ç½®ç®¡ç†

### LLM é…ç½®

é…ç½®å­˜å‚¨åœ¨ PagtiveConfig è¡¨ä¸­ï¼Œæ”¯æŒï¼š
- å¤šæ¨¡å‹é…ç½®ï¼ˆGPT-4ã€Claudeç­‰ï¼‰
- åŠ¨æ€åˆ‡æ¢æ¨¡å‹
- è‡ªå®šä¹‰æç¤ºè¯æ¨¡æ¿
- é…ç½®ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰

### æç¤ºè¯æ¨¡æ¿

ç³»ç»Ÿæ”¯æŒä¸¤ç§ä¸»è¦åœºæ™¯çš„æç¤ºè¯æ¨¡æ¿ï¼š
1. **ç”Ÿæˆæ¨¡æ¿** (generatePageCode) - ä»é›¶åˆ›å»ºé¡µé¢
2. **ç¼–è¾‘æ¨¡æ¿** (editPageCode) - ä¿®æ”¹ç°æœ‰é¡µé¢

æ¨¡æ¿æ”¯æŒä»¥ä¸‹å˜é‡ï¼š
- `{description}` - ç”¨æˆ·çš„æè¿°
- `{project_style}` - é¡¹ç›®é£æ ¼
- `{current_html}` - ç°æœ‰HTMLï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
- `{current_css}` - ç°æœ‰CSSï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰
- `{current_js}` - ç°æœ‰JSï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰

## å®‰å…¨æ€§è€ƒè™‘

1. **è®¤è¯æˆæƒ**
   - é™¤åˆ†äº«æ¥å£å¤–ï¼Œæ‰€æœ‰æ¥å£éœ€è¦ JWT è®¤è¯
   - ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„é¡¹ç›®
   - å…¬å¼€é¡¹ç›®é€šè¿‡ is_public æ ‡å¿—æ§åˆ¶

2. **XSS é˜²æŠ¤**
   - å‰ç«¯ä½¿ç”¨ iframe sandbox éš”ç¦»ç”Ÿæˆçš„å†…å®¹
   - é™åˆ¶ iframe æƒé™ï¼Œé˜²æ­¢æ¶æ„è„šæœ¬

3. **æ•°æ®éªŒè¯**
   - ä½¿ç”¨ Django åºåˆ—åŒ–å™¨éªŒè¯è¾“å…¥
   - æ–‡ä»¶ä¸Šä¼ é™åˆ¶ç±»å‹å’Œå¤§å°
   - SQL æ³¨å…¥é˜²æŠ¤é€šè¿‡ ORM å®ç°

## æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥**
   - é…ç½®æœåŠ¡å®ç° 5 åˆ†é’Ÿç¼“å­˜
   - å‡å°‘æ•°æ®åº“æŸ¥è¯¢

2. **æ‰¹é‡æ“ä½œ**
   - æ”¯æŒæ‰¹é‡åˆ›å»ºé¡µé¢
   - ä½¿ç”¨äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§

3. **å¼‚æ­¥å¤„ç†**
   - LLM è°ƒç”¨å¯ä»¥æ”¹ä¸ºå¼‚æ­¥ä»»åŠ¡
   - ä½¿ç”¨ Celery å¤„ç†é•¿æ—¶é—´æ“ä½œ

## å‰ç«¯é¡µé¢è·¯ç”±

```
/pagtive/
â”œâ”€â”€ page.tsx                    # é¡¹ç›®åˆ—è¡¨é¡µ
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ new/                   # åˆ›å»ºé¡¹ç›®
â”‚   â””â”€â”€ [projectId]/
â”‚       â”œâ”€â”€ preview/            # é¡¹ç›®é¢„è§ˆ
â”‚       â”œâ”€â”€ settings/           # é¡¹ç›®è®¾ç½®ï¼ˆå¾…å®Œå–„ï¼‰
â”‚       â””â”€â”€ pages/
â”‚           â”œâ”€â”€ new/            # æ–°å»ºé¡µé¢
â”‚           â””â”€â”€ [pageId]/edit/  # ç¼–è¾‘é¡µé¢
â””â”€â”€ share/[shareId]/           # å…¬å¼€åˆ†äº«
```

## å½“å‰å®æ–½çŠ¶æ€

### å·²å®ŒæˆåŠŸèƒ½ âœ…
- æ•°æ®æ¨¡å‹è®¾è®¡å’Œè¿ç§»
- é¡¹ç›®åˆ—è¡¨å±•ç¤º
- é¡¹ç›®åˆ›å»ºå’ŒAIç”Ÿæˆå¤§çº²
- é¡µé¢é¢„è§ˆåŠŸèƒ½
- åŸºç¡€ç¼–è¾‘åŠŸèƒ½
- åˆ†äº«æœºåˆ¶æ¡†æ¶
- LLM æœåŠ¡é›†æˆ
- é¡µé¢CRUDæ“ä½œ

### å¼€å‘ä¸­åŠŸèƒ½ ğŸ”„
- é¡µé¢ç¼–è¾‘å™¨å¢å¼º
- æ–‡ä»¶ä¸Šä¼ å®Œå–„
- é¡¹ç›®è®¾ç½®é¡µé¢

### å¾…å¼€å‘åŠŸèƒ½ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰â³
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®Œæˆ
- [ ] é¡µé¢å†å²å’Œç‰ˆæœ¬ç®¡ç†
- [ ] é¡¹ç›®è®¾ç½®é¡µé¢å®ç°
- [ ] å‘å¸ƒå’Œåˆ†äº«åŠŸèƒ½å®Œå–„
- [ ] é¡¹ç›®å…‹éš†/å¤åˆ¶åŠŸèƒ½
- [ ] è‰ç¨¿è‡ªåŠ¨ä¿å­˜

### å¾…å¼€å‘åŠŸèƒ½ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
- [ ] æœç´¢å’Œç­›é€‰åŠŸèƒ½
- [ ] æ“ä½œç¡®è®¤å¯¹è¯æ¡†
- [ ] æ‰¹é‡é¡µé¢æ“ä½œ
- [ ] é¡¹ç›®æ¨¡æ¿åŠŸèƒ½
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼ˆHTML/PDFï¼‰

### å¾…å¼€å‘åŠŸèƒ½ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
- [ ] åä½œåŠŸèƒ½
- [ ] æ•°æ®åˆ†æä»ªè¡¨æ¿
- [ ] è¯„è®ºç³»ç»Ÿ
- [ ] å®æ—¶åä½œ
- [ ] GraphQL æ”¯æŒ

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **è®¤è¯å¤±è´¥**
   - æ£€æŸ¥ JWT token æ˜¯å¦æœ‰æ•ˆ
   - ç¡®è®¤ä½¿ç”¨ authFetch å·¥å…·

2. **CORS é”™è¯¯**
   - æ£€æŸ¥ Django CORS é…ç½®
   - ç¡®è®¤å‰ç«¯ä»£ç†é…ç½®æ­£ç¡®

3. **LLM è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥ LLM æœåŠ¡é…ç½®
   - æŸ¥çœ‹ ProjectLLMLog æ—¥å¿—

4. **é¡µé¢å†…å®¹ä¸æ˜¾ç¤º**
   - æ£€æŸ¥ ProjectDetail æ•°æ®
   - ç¡®è®¤ iframe æƒé™è®¾ç½®

### æ—¥å¿—æŸ¥çœ‹

```bash
# Django æ—¥å¿—
tail -f /Users/chagee/Repos/X/backend/logs/django.log

# æ•°æ®åº“æŸ¥è¯¢
python manage.py dbshell
SELECT * FROM webapps_pagtive_project WHERE user_id = xxx;
SELECT * FROM webapps_pagtive_projectdetail WHERE project_id = 'xxx';
```

## ç›¸å…³æ–‡æ¡£

- `backend/webapps/pagtive/services/SERVICE_HANDBOOK.md` - æœåŠ¡å±‚è¯¦ç»†æ–‡æ¡£
- `web/src/app/pagtive/TODO-2025-09-02.md` - å¾…å¼€å‘åŠŸèƒ½è¯¦ç»†åˆ—è¡¨
- `docs/SYSTEM_ARCHITECTURE.md` - ç³»ç»Ÿæ•´ä½“æ¶æ„
- `/Users/chagee/Repos/Pagtive` - åŸé¡¹ç›®å‚è€ƒä»£ç 

## æ€»ç»“

Pagtive æ¨¡å—å®ç°äº†å®Œæ•´çš„ AI é©±åŠ¨é¡µé¢ç”ŸæˆåŠŸèƒ½ï¼Œé‡‡ç”¨æœåŠ¡å±‚æ¶æ„ç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ç³»ç»Ÿå·²ç»å…·å¤‡æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚åç»­å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€æ­¥å®Œå–„å’Œä¼˜åŒ–åŠŸèƒ½ã€‚

---
*æœ¬æ‰‹å†ŒæŒç»­æ›´æ–°ä¸­ï¼Œè¯·å…³æ³¨æœ€æ–°ç‰ˆæœ¬*