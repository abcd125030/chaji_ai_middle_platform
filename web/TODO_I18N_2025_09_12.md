# TODO List - 2025-09-12

## 实现 Next.js App Router 双语支持系统

### 背景描述
当前项目的 UI 文本为中英文混合硬编码，需要实现统一的国际化方案。支持通过 URL 参数（`?lang=en` / `?lang=zh-CN`）和语言切换器让用户选择语言，并将偏好保存在 localStorage 中。采用轻量级 Context + Hooks 方案，避免引入重型 i18n 库。

### 环境背景
- Next.js 15.3.3 (App Router)
- TypeScript 5.x
- 项目结构：前后端分离，web/ 为纯前端
- 当前无 i18n 相关依赖
- 已有 localStorage 使用模式（认证系统）

### 任务清单

#### 阶段一：基础架构搭建
- [ ] 创建 i18n 核心模块目录结构 `/src/lib/i18n/`
- [ ] 实现 LanguageContext 和 LanguageProvider
- [ ] 实现 useTranslation 和 useLanguage Hooks
- [ ] 创建语言检测和优先级处理工具函数
- [ ] 设置 localStorage 持久化机制
- [ ] 创建基础翻译字典结构

#### 阶段二：UI 组件集成
- [ ] 开发 LanguageSwitcher 组件
- [ ] 在 TopBar 组件中集成语言切换器
- [ ] 处理 URL 参数检测和同步
- [ ] 实现客户端 hydration 防闪烁机制
- [ ] 确保所有内部链接携带当前语言参数

#### 阶段三：核心页面国际化
- [ ] 提取并翻译登录页面（`/auth/login`）文本
- [ ] 提取并翻译聊天页面（`/chat`）文本
- [ ] 提取并翻译主导航和 TopBar 文本
- [ ] 提取并翻译站点配置（site-config.ts）

#### 阶段四：完整覆盖
- [ ] 提取并翻译所有页面静态文本
- [ ] 实现错误消息国际化
- [ ] 处理动态内容的翻译
- [ ] 添加翻译缺失的降级处理

#### 阶段五：优化和测试
- [ ] 实现翻译字典按需加载
- [ ] 添加 React.memo 优化渲染性能
- [ ] 测试 URL 参数切换功能
- [ ] 测试 localStorage 持久化
- [ ] 测试 SSR/CSR 兼容性

### 相关文件

#### 需要创建的文件
- `/src/lib/i18n/context.tsx` - 语言状态管理
- `/src/lib/i18n/hooks.ts` - 翻译和语言 Hooks
- `/src/lib/i18n/utils.ts` - 工具函数
- `/src/lib/i18n/translations/common.ts` - 通用翻译
- `/src/lib/i18n/translations/auth.ts` - 认证相关翻译
- `/src/lib/i18n/translations/chat.ts` - 聊天相关翻译
- `/src/components/ui/LanguageSwitcher.tsx` - 语言切换组件

#### 需要修改的文件
- `/src/app/layout.tsx` - 添加 LanguageProvider，动态设置 html lang
- `/src/components/ui/TopBar.tsx:58-92` - 集成 LanguageSwitcher 组件
- `/src/lib/site-config.ts:1-25` - 扩展配置支持多语言
- `/src/app/auth/login/page.tsx` - 应用翻译
- `/src/app/chat/page.tsx` - 应用翻译

### 技术规范

#### 语言优先级
```
URL 参数 (?lang=) > localStorage > 浏览器语言 > 默认语言 (zh-CN)
```

#### localStorage 结构
```json
{
  "userLanguagePreference": {
    "language": "en" | "zh-CN",
    "lastUpdated": "2025-09-12T10:00:00.000Z"
  }
}
```

#### 支持的语言
- `zh-CN` - 简体中文（默认）
- `en` - 英语

### 注意事项
- 使用 `'use client'` 指令处理语言切换逻辑
- 避免在服务端组件中直接访问 localStorage
- 使用 `suppressHydrationWarning` 避免 SSR 闪烁
- 不使用路径前缀（如 `/en/chat`），保持 URL 结构简单
- 提供翻译缺失时的降级方案（显示键名）